

#!/bin/bash

echo
echo -e "\x1B[1;33m

============ INFO GATHERING =============
Tarefa 3 -  MOD6
By Igor Capistrano\x1B[0m"

echo
echo -e  "
=============================================================================================================

"

if [[ -z $1 && -z $2 ]];
then
	echo "Uso incorreto!"
	echo "Exemplo de uso: ./infogathering alvo.com.br ou ./infogathering alvo.com.br lista.txt para descubrir arquivos e diretorios "
	exit 1
fi


ip=$(host $1 | grep "has address" | cut -d " " -f4)
echo "Endereço IP de $1 é $ip"

echo "DNS Servers para $1:"
servers=$(whois $1 | grep "nserver" | cut -d " " -f6)
echo "$servers"
email=$(host -t mx $1 | cut -d " " -f3)
if [ "$email" == "is" ]
then
	echo "Endereço de email de  $1 é:"
	host -t mx $1 | cut -d " " -f7
else
	echo "$1 não possui endereço de email cadastrado"
fi
hinfo=$(host -t hinfo $1 | cut -d " " -f3)
if [ "$hinfo" == "is" ]
then
	echo "HINFO do endereço $1 é:"
	host -t hinfo $1
else
	echo "Endereço $1 não possui hinfo visivel"
fi


echo
echo -e  "
============================================================================================================= 

"
echo "Informações do Dono:"
whois $1 | grep "owner" 
netrange=$(whois -h whois.arin.net $ip | grep "NetRange")
echo "$netrange" 
cidr=$(whois -h whois.arin.net $ip | grep "CIDR")
echo "$cidr" 

echo
echo -e  "
============================================================================================================= 

"

for dns in $servers
do
	echo "############ TESTANDO $dns #############"
	teste=$(host -ls $1 $dns | grep "REFUSED" | cut -d "(" -f2 | cut -d ")" -f1)
	if [ "$teste" == "REFUSED" ];
	then
		echo "Tempo expirado ou transferencia nao permitida"
	else
		host -ls $1 $dns
	fi
done

echo
echo -e  "
============================================================================================================= 

"


if [ -z "$2" ]
then
	echo "Caso queira descobrir diretorios e arquvios do alvo use: ./infogathering.sh alvo.com.br lista.txt"
	exit 1
else
	echo "Descobrindo diretórios e arquivos..."
	for palavra in $(cat $2)
	do

		diretorio=$(curl -s -o /dev/null -w "%{http_code}" $1/$palavra/)
		arquivo=$(curl -s -o /dev/null -w "%{http_code}" $1/$palavra)

		if [ $diretorio == "200" ]
		then
			echo "Diretorio encontrado: $palavra"
		fi

		if [ $arquivo == "200" ]
		then
			echo "Arquivo encontrando: $palavra"
		fi

	done
fi

